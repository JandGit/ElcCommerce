package com.android.tkengine.elccommerce.presenter;import android.content.Context;import android.content.Intent;import android.net.Uri;import android.os.Handler;import android.os.Message;import android.support.v7.app.AppCompatActivity;import android.support.v7.widget.RecyclerView;import android.util.SparseArray;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.RatingBar;import android.widget.TextView;import com.android.tkengine.elccommerce.R;import com.android.tkengine.elccommerce.UI.DisplayActivity;import com.android.tkengine.elccommerce.beans.StoreDetailsBean;import com.android.tkengine.elccommerce.model.ElcModel;import com.squareup.picasso.Picasso;/** * Created by FangYu on 2016/8/13. */public class StoreDetailsPresenter {    public StoreDetailsBean mData = new StoreDetailsBean();    public void clickBack(final AppCompatActivity activity , View v){        v.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                switch (view.getId()){                    case R.id.title_back:                        activity.finish();                        break;                    case R.id.title_message:                        break;                }            }        });    }    public class StoreDetailsAdapter extends RecyclerView.Adapter<StoreDetailsAdapter.MyViewHolder>{        Context mContext;        LayoutInflater mInflater;        String id;        private static final int TYPE_ITEM1 = 1;        private static final int TYPE_ITEM2 = 2;        private static final int GET_SUCCESS = 3;        private static final String PAGESIZE = "10";        private Handler handler = new Handler(){            @Override            public void handleMessage(Message msg) {                switch (msg.what){                    case GET_SUCCESS:                        notifyDataSetChanged();                        break;                    default:                        break;                }}};        public StoreDetailsAdapter( String id, Context context) {            this.id = id;            this.mContext = context;            mInflater = LayoutInflater.from(mContext);            initData();        }        private void initData() {            new Thread(new Runnable() {                @Override                public void run() {                    try{                       mData = new ElcModel(mContext).getStore(id, "1", PAGESIZE);                        Message message = new Message();                        message.what = GET_SUCCESS;                        handler.sendMessage(message);                    }catch (Exception e){                        e.printStackTrace();                    }                }            }).start();        }        @Override        public int getItemViewType(int position) {            if(position == 0)                return TYPE_ITEM1;            else                return TYPE_ITEM2;        }        @Override        public MyViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {            MyViewHolder holder = null;            switch (viewType){                case TYPE_ITEM1:                    holder = new MyViewHolder(mInflater.inflate(R.layout.store_item1, parent, false));                    break;                case TYPE_ITEM2:                    holder = new MyViewHolder(mInflater.inflate(R.layout.store_item2, parent, false));                    break;            }            return holder;        }        @Override        public void onBindViewHolder(MyViewHolder holder, final int position) {            switch (holder.getItemViewType()){                case TYPE_ITEM1:                    ImageView storeIcon = (ImageView) holder.getView(R.id.store_detail_icon);                    TextView storeName = (TextView) holder.getView(R.id.store_detail_name);                    TextView storeSales = (TextView) holder.getView(R.id.store_detail_sales);                    TextView storeDes = (TextView) holder.getView(R.id.store_detail_description);                    RatingBar storeGrade = (RatingBar) holder.getView(R.id.store_detail_grade);                    ImageView storePhone = (ImageView) holder.getView(R.id.store_detail_phone);                    Picasso.with(mContext).load(mData.getSeller_shopPicture()).fit().into(storeIcon);                    storeName.setText(mData.getSeller_shopName());                    storeSales.setText("月销" + mData.getSeller_sales());                    storeDes.setText(mData.getSeller_shopDescription());                    storeGrade.setProgress(mData.getSeller_grade());                    storePhone.setOnClickListener(new View.OnClickListener() {                        @Override                        public void onClick(View view) {                            Intent intent = new Intent(Intent.ACTION_DIAL);                            intent.setData(Uri.parse("tel:" + mData.getSeller_phone()));                            mContext.startActivity(intent);                        }                    });                    break;                case TYPE_ITEM2:                    LinearLayout goodsItem1 = (LinearLayout) holder.getView(R.id.store_goods_item1);                    LinearLayout goodsItem2 = (LinearLayout) holder.getView(R.id.store_goods_item2);                    ImageView goodsIcon1 = (ImageView) holder.getView(R.id.store_goods_icon1);                    ImageView goodsIcon2 = (ImageView) holder.getView(R.id.store_goods_icon2);                    TextView goodsName1 = (TextView) holder.getView(R.id.store_goods_name1);                    TextView goodsName2 = (TextView) holder.getView(R.id.store_goods_name2);                    TextView goodsPrice1 = (TextView) holder.getView(R.id.store_goods_price1);                    TextView goodsPrice2 = (TextView) holder.getView(R.id.store_goods_price2);                    TextView goodsSales1 = (TextView) holder.getView(R.id.store_goods_sales1);                    TextView goodsSales2 = (TextView) holder.getView(R.id.store_goods_sales2);                    if(mData.getProduct_list() != null){                        Picasso.with(mContext).load(mData.getProduct_list().get(position).getPicture_url()).fit().into(goodsIcon1);                        goodsName1.setText(mData.getProduct_list().get(position).getProduct_name());                        goodsPrice1.setText(mData.getProduct_list().get(position).getProduct_price() + "");                        goodsSales1.setText(mData.getProduct_list().get(position).getProduct_sales() + "人付款");                        Picasso.with(mContext).load(mData.getProduct_list().get(position+1).getPicture_url()).fit().into(goodsIcon2);                        goodsName2.setText(mData.getProduct_list().get(position+1).getProduct_name());                        goodsPrice2.setText(mData.getProduct_list().get(position+1).getProduct_price() + "");                        goodsSales2.setText(mData.getProduct_list().get(position+1).getProduct_sales() + "人付款");                        goodsItem1.setOnClickListener(new View.OnClickListener() {                            @Override                            public void onClick(View view) {                                Intent intent = new Intent(mContext, DisplayActivity.class);                                intent.putExtra("productID", mData.getProduct_list().get(position).getProduct_id());                                mContext.startActivity(intent);                            }                        });                        goodsItem2.setOnClickListener(new View.OnClickListener() {                            @Override                            public void onClick(View view) {                                Intent intent = new Intent(mContext, DisplayActivity.class);                                intent.putExtra("productID", mData.getProduct_list().get(position + 1).getProduct_id());                                mContext.startActivity(intent);                            }                        });                    }                    break;            }        }        @Override        public int getItemCount() {            if(mData.getProduct_list() != null){                return mData.getProduct_list().size()/2 + 1;            }            return 0;        }        public class MyViewHolder extends RecyclerView.ViewHolder{            SparseArray<View> allViews = new SparseArray<>();            View convertView;            public MyViewHolder(View itemView) {                super(itemView);                convertView = itemView;            }            //获得id对应的view            public View getView(int id){                View view = allViews.get(id);                if(null == view){                    view = convertView.findViewById(id);                    allViews.put(id, view);                }                return view;            }        }    }}